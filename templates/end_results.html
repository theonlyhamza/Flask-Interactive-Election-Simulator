<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Final Election Results</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/end_results.css') }}">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <header class="top-header">
        <div class="container top-bar-content">
            <img
                src="https://images.seeklogo.com/logo-png/41/1/emblem-of-the-election-commission-of-pakistan-logo-png_seeklogo-411520.png">
            <div class="top-title">Final Election Results</div>
        </div>
    </header>
    <nav>
        <div class="container">
            <ul>
                <li><a href="{{ url_for('admin_dashboard') }}">Dashboard</a></li>
                <li><a class="active" href="#">Final Results</a></li>
                <li><a href="{{ url_for('admin_login') }}">Support</a></li>
                <li><a href="{{ url_for('about') }}" class="active">About Us</a></li>
                <li><a href="{{ url_for('admin_login') }}">Logout</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">

            <div class="page-title">
                <h1>Election Results Declared</h1>
                <p class="subtitle">Voting has officially ended</p>
            </div>

            <!-- OVERALL WINNER -->
            <div class="winner-box highlight">
                <h2>üèÜ Overall Winning Party</h2>
                <p class="winner-name">{{ overall_winner }}</p>
            </div>

            <!-- AREA RESULTS TABLE -->
            <div class="results-card">
                <h2>Area-wise Winners</h2>

                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Area</th>
                            <th>Winning Party</th>
                            <th>Total Votes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for area, data in area_results.items() %}
                        <tr>
                            <td>{{ area }}</td>
                            <td>{{ data.party }}</td>
                            <td>{{ data.votes }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- GRAPHS -->
            <div class="results-grid">

                <div class="results-card">
                    <h3>Votes by Area (Bar Chart)</h3>
                    <canvas id="areaChart"></canvas>
                </div>

                <div class="results-card">
                    <h3>Winning Share (Pie Chart)</h3>
                    <canvas id="pieChart"></canvas>
                </div>

            </div>

            <!-- DOWNLOAD SECTION -->
            <div class="download-box">
                <a href="{{ url_for('download_votes') }}" class="vote-btn">Download Votes JSON</a>
                <a href="{{ url_for('download_voters') }}" class="vote-btn">Download Voters JSON</a>
            </div>

        </div>
    </main>

    <script>
        const areas = {{ area_results.keys() | list | tojson }};
        const votes = {{ area_results.values() | map(attribute = 'votes') | list | tojson }};
        const parties = {{ area_results.values() | map(attribute = 'party') | list | tojson }};

        /* BAR CHART */
        new Chart(document.getElementById('areaChart'), {
            type: 'bar',
            data: {
                labels: areas,
                datasets: [{
                    label: 'Votes',
                    data: votes,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        /* PIE CHART */
        const partyCounts = {};
        parties.forEach(p => partyCounts[p] = (partyCounts[p] || 0) + 1);

        new Chart(document.getElementById('pieChart'), {
            type: 'pie',
            data: {
                labels: Object.keys(partyCounts),
                datasets: [{
                    data: Object.values(partyCounts)
                }]
            }
        });
    </script>

</body>

</html>